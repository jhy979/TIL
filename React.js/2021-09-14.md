# Redux

## Redux : ê°œìš”

### ì™œ ì“¸ê¹Œìš”?

- ì¤‘ì²©ë˜ê³  ë³µìž¡í•œ props ë¬¸ë²•ì„ ëŒ€ì²´í•  ìˆ˜ ìžˆì–´ìš”.
- state ê´€ë¦¬ ìš©ì´í•´ìš”.

ðŸ‘‰ `ContextAPI` ë¥¼ ì‚¬ìš©í•  ë•Œ ì „ì—­ ë°ì´í„°ë¥¼ ì–´ë–»ê²Œ íš¨ê³¼ì ìœ¼ë¡œ ê´€ë¦¬í• ì§€ ë„ì›€ì„ ì£¼ëŠ” ê²ƒì´ `Redux` ìž…ë‹ˆë‹¤.

### ë§Œë“¤ê¸°

1. import redux
2. ì•¡ì…˜ ì •ì˜
3. (ì•¡ì…˜ì„ ì‚¬ìš©í•˜ëŠ”) ë¦¬ë“€ì„œ ìƒì„±
4. ë¦¬ë“€ì„œ í•©ì¹˜ê¸°
5. í•©ì³ì§„ ë¦¬ë“€ì„œë¥¼ ì¸ìžë¡œ ë‹¨ì¼ Store ìƒì„±í•˜ê¸°

### ì‚¬ìš©í•˜ê¸°

1. import react-redux
2. connect í•¨ìˆ˜ë¡œ ì»´í¬ë„ŒíŠ¸ì— ì—°ê²°

---

## Redux : Action

### Actionì´ëž€?

- ì¼ë°˜ `ê°ì²´`ìž…ë‹ˆë‹¤.
- Actionì˜ typeì€ ì•„ëž˜ì²˜ëŸ¼ ë¬¸ìžì—´ìž…ë‹ˆë‹¤.
- 2ê°€ì§€ í˜•íƒœê°€ ì¡´ìž¬í•©ë‹ˆë‹¤.

```jsx
{type : 'TEST'} //payload ì—†ëŠ” ì•¡ì…˜
{type:'TEST', params:'hello'} //payload ìžˆëŠ” ì•¡ì…˜
```

### Action ìƒì„±ìž

```jsx
function ì•¡ì…˜ìƒì„±ìž(...agrs) {
	return ì•¡ì…˜;
}
```

- í•¨ìˆ˜ë¡œ ì•¡ì…˜ì„ ìƒì„±í•´ì„œ ì•¡ì…˜ ê°ì²´ë¥¼ ë„˜ê²¨ì¤„ ìˆ˜ ìžˆë„ë¡ í•©ë‹ˆë‹¤.

### ìˆœì„œ

1. ì•¡ì…˜ ìƒì„±ìžë¡œ ì•¡ì…˜ ë§Œë“¤ê¸°
2. ë§Œë“¤ì–´ì§„ ì•¡ì…˜ ê°ì²´ë¥¼ redux storeì— ë³´ë‚´ê¸°
3. redux storeê°€ ì•¡ì…˜ ê°ì²´ë¥¼ ë°›ìœ¼ë©´ stateê°’ì´ ë³€ê²½ë¨
4. stateê°’ì„ ì‚¬ìš©í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ë“¤ì´ ë³€ê²½ë¨

### ì•¡ì…˜ ì¤€ë¹„í•˜ê¸°

- ì•¡ì…˜ì˜ typeì„ ì •ì˜í•˜ì—¬ ë³€ìˆ˜ë¡œ ë¹¼ëŠ” ë‹¨ê³„ (í•„ìˆ˜ëŠ” ì•„ë‹ˆì§€ë§Œ, ì‹¤ìˆ˜ í™•ë¥ ì´ ì¤„ì–´ìš”)
- ì•¡ì…˜ ê°ì²´ë¥¼ ë§Œë“¤ì–´ ë‚´ëŠ” í•¨ìˆ˜ë¥¼ ë§Œë“œëŠ” ë‹¨ê³„

### Action ì˜ˆì‹œ

- `/redux/actions.js`

```jsx
// ë¬¸ìžì—´ì„ ë³€ìˆ˜ë¡œ ì €ìž¥í•˜ê¸°
export const ADD_TODO = 'ADD_TODO';

//ì•¡ì…˜ ìƒì„± í•¨ìˆ˜
function addTodo(todo){
  return {
    type: ADD_TODO,
    todo, 
  }
}
```

ðŸ˜€ `redux`ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ìƒì„±í•˜ì§€ ì•Šê³  actioní•¨ìˆ˜ë¥¼ ì •ì˜í–ˆìŠµë‹ˆë‹¤.

---

## Redux : reducer

### Reducerëž€?

- ì•¡ì…˜ì„ ì£¼ë©´, ê·¸ ì•¡ì…˜ì´ ì ìš©ë˜ì–´ ë‹¬ë¼ì§„ ê²°ê³¼ë¥¼ ë§Œë“¤ì–´ì£¼ëŠ” `í•¨ìˆ˜`ìž…ë‹ˆë‹¤.
- Pure Function : í•­ìƒ ê°™ì€ inputì´ë©´ ê°™ì€ outputì„ ë‚´ëŠ” í•¨ìˆ˜ìž…ë‹ˆë‹¤.
- Immutable : ë¦¬ë“€ì„œë¥¼ í†µí•´ stateê°€ ë‹¬ë¼ì¡ŒìŒì„ ì¸ì§€í•˜ëŠ” ë°©ì‹

ðŸ¤” í•¨ìˆ˜í˜• í”„ë¡œê·¸ëž˜ë° ê³µë¶€í–ˆì„ ë•Œì˜ ì„±ê²©ì„ ê·¸ëŒ€ë¡œ ê°€ì§€ê³  ìžˆëŠ” ë“¯ í•©ë‹ˆë‹¤.

```jsx
function ë¦¬ë“€ì„œ (previousState, action){
	return newState;
}
```

- reducer í•¨ìˆ˜ ì˜ˆì‹œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. `/redux/reducers.js`

```jsx
import { ADD_TODO } from "./actions";

// state
// ['ì½”ë”©','ì ì‹¬ë¨¹ê¸°'];
const initialState = []; // ì´ë ‡ê²Œ default ê°’ì„ ì¤˜ë„ ì¢‹ìŠµë‹ˆë‹¤.

function todoApp(previousState = initialState, action) {

  // ì´ˆê¸°ê°’ ì„¤ì •í•˜ê¸°
  if (previousState === undefined) {
    return [];
  } 

  else if (action.type === ADD_TODO) {
    //immutableí•˜ê¸° ìœ„í•´ previousState.push()ë¥¼ ì‚¬ìš©í•˜ë©´ ì•ˆë©ë‹ˆë‹¤. 
    return [...previousState, action.todo]
  }
  
  else {
    return previousState
  }
}
```

ðŸ˜… ë°˜ë“œì‹œ immutableì„ ì§€ì¼œì•¼í•©ë‹ˆë‹¤.

---

## Redux : createStore

### storeë¥¼ ë§Œë“œëŠ” í•¨ìˆ˜

```jsx
const store = createStore (reducer, preloadedState, enhacner)
```

### ì˜ˆì‹œ

- `/redux/store.js`

```jsx
import {createStore} from 'redux';
import {todoApp} from './reducers'

const store = createStore(todoApp);

export default store;
```

- `console.log(store)`ë¥¼ ì°ì–´ë³´ë‹ˆ ì—¬ëŸ¬ í•¨ìˆ˜ê°€ ì¡´ìž¬í•©ë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/32920566/133249518-21353209-5767-40d2-a796-6d91b5c88a8b.png)


### `store.getState()`

```jsx
console.log(store.getState()) // stateê°’ ì¶œë ¥
```

### `store.dispatch()`

```jsx
store.dispatch(addTodo('coding')) // stateê°’ ë³€ê²½
store.dispatch(addTodo('eat')) // stateê°’ ë³€ê²½
store.dispatch(addTodo('sleep')) // stateê°’ ë³€ê²½
```

### `store.subscribe()`

```jsx
// storeì— ë³€ê²½ ì‚¬í•­ì´ ìƒê¸°ëŠ”ì§€ êµ¬ë…í•©ë‹ˆë‹¤.
// ë³€ê²½ë˜ë©´ í•¨ìˆ˜ê°€ í˜¸ì¶œë©ë‹ˆë‹¤.
// ë°˜í™˜ê°’ì€ í•¨ìˆ˜ìž…ë‹ˆë‹¤. unsubscribe(); í•˜ë©´ êµ¬ë… ì·¨ì†Œ!
const unsubscribe = store.subscribe(()=>{
  console.log(store.getState())
})

unsubscribe() // ì´ì œ ë³€ê²½ë˜ì–´ë„ í•¨ìˆ˜ ì‹¤í–‰ì´ ì•ˆë©ë‹ˆë‹¤.
```

### `store.replaceReducer`

- ë‹¤ë¥¸ ë¦¬ë“€ì„œë¡œ ëŒ€ì²´í•©ë‹ˆë‹¤.
- ì‹¤ë¬´ì—ì„œëŠ” ìž˜ ì•ˆ ì“°ìž…ë‹ˆë‹¤.

---

## Redux : combineReducers

### ì™œ í•„ìš”í• ê¹Œ?

- reducerë¥¼ ìž‘ì„±í•˜ë‹¤ë³´ë©´ ë³µìž¡í•´ì§‘ë‹ˆë‹¤.
- ë”°ë¼ì„œ, reducerë¥¼ A.js, B.js, ... ì—¬ëŸ¬ íŒŒì¼ë¡œ ë‚˜ëˆ„ì–´ í•œ ë²ˆì— í•©ì¹  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.

```jsx
const reducer = combineReducers({
  todos: todos,
  filter: filter
})
```

ðŸ˜… ë‚´ìš©ì´ ìƒë‹¹ížˆ ë³µìž¡í•´ì„œ MarkDownì— ì „ë¶€ ì‚½ìž…í•˜ê¸°ê°€ ì–´ë ¤ìš¸ ì •ë„ìž…ë‹ˆë‹¤.

## Redux : React ì—°ê²°

### `react-redux` ì•ˆì“°ê³  ì—°ê²°í•˜ê¸°

- subscribeì™€ unsubscribeë¡œ componentDidMount, componentWillUnmout ë¡œ ì‚¬ìš¯í•©ë‹ˆë‹¤.

```jsx
function App({store}) {
  const [state,setState] = useState(store.getState());
  useEffect(()=>{
    const unsubscribe = store.subscribe(()=>{
      setState(store.getState())
    })
    return ()=>{
      unsubscribe();
    }
  },[store])

	...
}
```
